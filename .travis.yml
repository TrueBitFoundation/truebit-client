dist: bionic
sudo: required
language: node_js
node_js:
  - "8.11.3"

cache:
  directories:
    - "node_modules"

before_install:
  # Install Ethereum Tools
  - sudo add-apt-repository ppa:ethereum/ethereum -y
  - sudo apt-get update
  - sudo apt-get install software-properties-common
  - sudo apt-get install solc
  # Install Ganache & Truffle
  - npm i -g ganache-cli truffle@4.1.8
  - ganache-cli &>/dev/null &
  # Install IPFS
  - wget "https://dist.ipfs.io/go-ipfs/v0.4.9/go-ipfs_v0.4.9_linux-amd64.tar.gz" -O /tmp/ipfs.tar.gz
  - pushd . && cd $HOME/bin && tar -xzvf /tmp/ipfs.tar.gz && popd
  - export PATH="$HOME/bin/go-ipfs:$PATH"
  - ipfs init
  - ipfs daemon &
  - sleep 15
  - curl http://localhost:5001/api/v0/id

  # Install ocaml
  - sudo apt-get install -y wget gcc ocaml opam libzarith-ocaml-dev m4 pkg-config zlib1g-dev libffi-dev
  - opam init -y --comp=4.06.1
#  - opam init -y --comp=4.05.0
#  - eval $(opam config env)
#  - opam update
#  - opam install -y cryptokit yojson ctypes ctypes-foreign

install:
  - npm run fixperms
  - npm install
#  - npm run install
  - npm run deps
  - npm run compile
  - npm run deploy

deploy:
  provider: releases
  api_key:
    secure: kyH9BfKnuBRWNZwhVi3P0AZ+FCwp/IxzTGt2erMoajM/rxeuI99ZnGWhQHzakHwtVwjRmTxnHMio8S1w1cb1VCSt6uahJcfaiejw/PKUGq4NVCDm8BshQ2+rMJc7B8c10f86C3dfSUVKnSHcOyawsJYrWNoxUP2crzGheP7NzV082qoEhS9HqVd/Kyc0PJUEiEWGN6QSSsw15Epedh+QggXniejsGN337/UNWvTAKzX0Eg7iZCBheiSTy9yxc5uGY0JcXIukdZhtShPs3GEURIH9Uj6Z0Oaq4fs+M0cJzGANbZOpYwRnwgnbBkhUAkbLD7MQF/SR9Asur2w4+7a17UV+0eH+dNCxU57rIoBMe/WWqICJno/ln3fEyaZYTEgVyd5TTDaTGodYTRqwLKbLJf6ZdBOuAJ9jLYZ+wjbDvgogAc/XPyehfr7OcrtYGTfDQvsydXHmjKtz04M0ciZIyfBN5aIvggEXMzHj34a4uNGtu/c2jbybKVjOLhyEOAJyXqQj8svR6KruDTOzg+KcS5I7TqNVjRC8uDj3k2dMc6IKvejdVLSIBUUdrMdAv56/eGvYkiMvenDjydGlmx9i6EQ1J+cy3cz2EgOUTVluX9do59I3o0Dgpdv8MF9RyGnvwtahfIQCuNNM8gJ5r16Os5+MuxW7outl38vrzzc8Njo=
  file: ''
  on:
    repo: TrueBitFoundation/truebit-os

script:
  - NODE_ENV='production' npm run test
